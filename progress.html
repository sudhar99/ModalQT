<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
 <meta charset="utf-8" />
 <title>Accessible Progress bar - Samples </title>

<!-- CSS Includes -->
<link rel="stylesheet" type="text/css" href="https://my.calpers.ca.gov/web/css/ept-mss/uswds-2_4-mycal.css" />
<link rel="stylesheet" type="text/css" href="https://my.calpers.ca.gov/web/css/ept-mss/datatables.min.css" />
<link rel="stylesheet" type="text/css" href="https://my.calpers.ca.gov/web/css/ept-mss/style.css" />
<!--Security Image is not included in mss-includes.css. Adding here.--> 
<!--NOTE: Needs to load before cards.css, or else spacing is thrown off.-->
<link rel="stylesheet" type="text/css" href="https://my.calpers.ca.gov/web/css/ept-mss/security-image.css" />
<link rel="stylesheet" type="text/css" href="https://my.calpers.ca.gov/web/css/ept-mss/mss-includes.css" />
<!--
Until tabs.css is updated in mss-includes.css, adding here. DELETE ON 4/25
5/21: Commented out tabs.css direct link to make sure tabs.css is in mss-includes.css. Wait until next release to delete completely.
-->
<!--<link rel="stylesheet" type="text/css" href="https://my.calpers.ca.gov/web/css/ept-mss/tabs.css" />-->
<link rel="stylesheet" type="text/css" href="https://my.calpers.ca.gov/web/css/ept-mss/new-experience-slider.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,600i,700,700i,800,800i" rel="stylesheet" type="text/css">
<script src="./js/prototype.js"></script>
<script src="./js/jquery-3.4.1.slim.min.js"></script>
<link rel="stylesheet" href="./css/mss.css" />
<style>


.invisible {
  border: 0;
  clip: rect(0 0 0 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

.hidden { display: none; }


/* needed for old browsers */
dialog {
  display: block;
  border: 0;
}
</style>
<script> 
	var $j = jQuery.noConflict();
</script>
<script src="./js/ept.js"></script>
</head>
<body>

    <div id="main-content" class="mycal-main-content">
        <div class="calpers-grid">
            <div class="calpers-columns-column-main">
                <div class="calpers-section-body">

                    <p id="summary">
                        This HTML5 progress bar has been implemented with <code>aria-live="polite"</code> as the only ARIA in use. The separate announcements by screen readers for the progress bar and textual updates are achieved by putting them in separate live regions.
                    </p>
        
                    <progress id="progressBar" max="100" value="0">
        
                        <!-- Fallback -->
                        <div id="progressBarFallback1"><span id="progressBarFallback2">&#160;</span></div>
        
                    </progress>

                    <div>
                        <span id="progressLabel">Progress: </span>
        
                        <!-- Separate live region for the progress -->
                        <span aria-live="polite" id="progressPercent">0%</span>
                    </div>
        
                    <!-- Separate live region for the message -->
                    <div aria-live="polite" id="message">Click the start button to begin testing</div>
                    
                    <button id="startButton">Start</button>
                    <button id="resetButton">Reset</button>
                </div>
                
            </div>
        </div>
    </div>
    
    <script src="./js/van11y-accessible-modal-window-aria.js"></script>
    
    <script>
        (function() {	
            
            var updateProgress;

            
            function updateProgress() {
                var message, progress, progressBar, progressPercent, startButton, resetButton, intervalId, progressBarFallback2;
                progress = 0;
                message = document.getElementById('message');
                resetButton = document.getElementById('resetButton');
                resetButton.disabled = 'true';
                progressBarFallback2 = document.getElementById('progressBarFallback2');

                return function () {
                    progressPercent = document.getElementById('progressPercent');
                    progressBar = document.getElementById('progressBar');
                    startButton = document.getElementById('startButton');

                    //Update the progress bar
                    if ( progress <= 100 ) {
                        progressBar.value = progress;

                        //First update the fallback width
                        progressBarFallback2.style.width = progress + '%';

                        
                        progressPercent.innerHTML = progressBar.value + '%';
                        progress += 10;
                    } else {
                        progress = 0;
                        stop();
                    }
                }
            }	

            //Accessing the closure  
            updateProgress = updateProgress();

            function preStart() {
                //Simulate a waiting period
                message.innerHTML = 'Testing will begin shortly';
                startButton.disabled = true;
                setTimeout(function() { start(); }, 3000);
            }

            function start() {
                //Start the progress meter 
                //Disable the start button
                intervalId = setInterval( function() { updateProgress(); }, 3000); 	
                message.innerHTML = 'Testing in progress';
                startButton.disabled = true;
            } 

            function stop() {
                //Stop the progress meter
                clearInterval(intervalId);
                message.innerHTML = 'Testing is complete. Click the Reset button to test again.';
                resetButton.disabled = false;
            }

            function reset () {

                //Reset the progress meter and manage the button states
                progressBar.value = 0;

                //Reset the fallback width
                progressBarFallback2.style.width = 0;

                progressPercent.innerHTML = progressBar.value + '%';
                startButton.disabled = false;
                resetButton.disabled = true;
                message.innerHTML = 'Click the start button to begin testing';
            }
            
            startButton.disabled = false;
            
            //Event Registration
            startButton.onclick = function() { preStart(); };
            resetButton.onclick = function() { reset(); };
            
        }());

    </script>
</body>
</html>